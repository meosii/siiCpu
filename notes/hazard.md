## 数据冒险

数据冒险是一种流水线处理器中的问题，它发生在通用寄存器的写入操作和读取操作之间存在时间差的情况下。通用寄存器的写入操作通常在流水线的最后一个阶段完成，而读取操作则在译码阶段进行。这样，如果一条指令要向一个寄存器写入数据，而紧接着的一条指令要从这个寄存器读取数据，就会出现数据不一致的情况，因为读取操作会得到旧的寄存器值，而不是新写入的值。为了解决数据冒险，一般有两种方法：直通和暂停。

直通的方法是将写入寄存器的数据直接传送给需要读取寄存器的指令，而不经过寄存器。这种方法适用于写入数据已经准备好的情况，例如算术逻辑单元（ALU）的计算结果或者跳转指令的目标地址。但是，如果写入数据需要从内存中加载，就不能使用直通的方法，因为内存的访问需要一个时钟周期，即第四个流水线阶段给出内存地址，第五个流水线阶段才能得到内存数据。这种情况下，就需要使用暂停的方法，即在发现数据冒险时，暂停流水线的前面几个阶段，等待内存数据加载完成后，再继续执行。

需要注意的是，如果涉及到寄存器读取的指令是有条件跳转指令，那么就需要对寄存器值加上一个有效位（valid）信号，表示该值是否可用。只有当该值有效时，才能进行跳转条件的判断。否则，如果跳转指令得到了错误的寄存器值，就可能导致错误的跳转行为，并且由于流水线被暂停，无法及时纠正。表现为，发生 load_hazard 时，暂停流水线 pc, if_reg ，刷新 id_reg，取到 gpr_data 后，发生跳转，更新 pc，刷新 if_reg。